function enableImagePairs(document) {
    const imagePairs = document.querySelectorAll('.image-pair');

    imagePairs.forEach(pair => {
        const images = pair.querySelectorAll('.image-comparison');
        const titles = pair.querySelectorAll('.image-title');
        let activeState = 'source';

        function applyActiveState(newState) {
            images.forEach(img => {
                img.style.display = (img.dataset.state === newState) ? 'block' : 'none';
            });

            titles.forEach(title => {
                title.style.fontWeight = (title.dataset.state === newState) ? 'bold' : 'normal';
            });

            activeState = newState;
        }

        function swapImagesAndTitles() {
            const newState = activeState === 'source' ? 'golden' : 'source';
            applyActiveState(newState);
        }

        applyActiveState(activeState);
        images.forEach(img => {
            img.addEventListener('click', swapImagesAndTitles);
        });
    });
}

function enableViewLinks(document) {
    const viewLinks = document.querySelectorAll('.view-link');

    viewLinks.forEach(link => {

        const container = link.closest('.titled-image-container');
        if (container) {
            const hiddenImage = container.querySelector('.hidden-image');
            if (hiddenImage) {

                link.addEventListener('click', (event) => {
                    event.preventDefault();
                    hiddenImage.style.display = 'block';
                    link.style.display = 'none';
                });

                hiddenImage.addEventListener('click', () => {
                    hiddenImage.style.display = 'none';
                    link.style.display = 'block';
                });
            }
        }
    });
}

function enableIgnoreAlpha(document) {
    const ignoreAlphaCheckbox = document.getElementById('ignore-alpha');
    if (!ignoreAlphaCheckbox) {
        return;
    }
    ignoreAlphaCheckbox.addEventListener('change', () => {
        const images = document.querySelectorAll('img[data-noalpha]');

        if (ignoreAlphaCheckbox.checked) {
            images.forEach(img => {
                img.dataset.noalphaOriginalUrl = img.src;
                img.dataset.noalphaOriginalAlt = img.alt;
                img.src = img.dataset.noalpha;
                img.alt = img.alt + " disregarding alpha";
            });
        } else {
            images.forEach(img => {
                img.dataset.noalphaOriginalUrl = img.src;
                img.dataset.noalphaOriginalAlt = img.alt;
                img.src = img.dataset.noalphaOriginalUrl;
                img.alt = img.dataset.noalphaOriginalAlt;
            });
        }
    });
}

document.addEventListener('DOMContentLoaded', () => {
    enableIgnoreAlpha(document);
    enableViewLinks(document);
    enableImagePairs(document);
});